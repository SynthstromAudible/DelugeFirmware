/**
 * Copyright (c) 2025 Katherine Whitlock
 *
 * This file is part of The Synthstrom Audible Deluge Firmware.
 *
 * The Synthstrom Audible Deluge Firmware is free software: you can redistribute it and/or modify it under the
 * terms of the GNU General Public License as published by the Free Software Foundation,
 * either version 3 of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */
#include "triangle.hpp"

using namespace deluge::dsp::oscillator;

// 64-value
std::array<int16_t, 65> triangleWaveAntiAliasing1 = {
    -26582, -26454, -26071, -25437, -24559, -23443, -22102, -20548, -18796, -16863, -14768, -12531, -10173,
    -7716,  -5186,  -2605,  0,      2605,   5186,   7716,   10173,  12531,  14768,  16863,  18796,  20548,
    22102,  23443,  24559,  25437,  26071,  26454,  26582,  26454,  26071,  25437,  24559,  23443,  22102,
    20548,  18796,  16863,  14768,  12531,  10173,  7716,   5186,   2605,   0,      -2605,  -5186,  -7716,
    -10173, -12531, -14768, -16863, -18796, -20548, -22102, -23443, -24559, -25437, -26071, -26454, -26582,
};
std::array<int16_t, 65> triangleWaveAntiAliasing3 = {
    -29555, -29299, -28543, -27323, -25696, -23735, -21522, -19147, -16694, -14242, -11853, -9572,  -7426,
    -5419,  -3534,  -1743,  0,      1743,   3534,   5419,   7426,   9572,   11853,  14242,  16694,  19147,
    21522,  23735,  25696,  27323,  28543,  29299,  29555,  29299,  28543,  27323,  25696,  23735,  21522,
    19147,  16694,  14242,  11853,  9572,   7426,   5419,   3534,   1743,   0,      -1743,  -3534,  -5419,
    -7426,  -9572,  -11853, -14242, -16694, -19147, -21522, -23735, -25696, -27323, -28543, -29299, -29555,
};

// 128-value
std::array<int16_t, 129> triangleWaveAntiAliasing5 = {
    -30590, -30494, -30209, -29742, -29107, -28320, -27402, -26376, -25267, -24098, -22894, -21676, -20465,
    -19276, -18120, -17007, -15939, -14917, -13936, -12989, -12068, -11161, -10258, -9348,  -8421,  -7470,
    -6489,  -5475,  -4428,  -3351,  -2249,  -1129,  0,      1129,   2249,   3351,   4428,   5475,   6489,
    7470,   8421,   9348,   10258,  11161,  12068,  12989,  13936,  14917,  15939,  17007,  18120,  19276,
    20465,  21676,  22894,  24098,  25267,  26376,  27402,  28320,  29107,  29742,  30209,  30494,  30590,
    30494,  30209,  29742,  29107,  28320,  27402,  26376,  25267,  24098,  22894,  21676,  20465,  19276,
    18120,  17007,  15939,  14917,  13936,  12989,  12068,  11161,  10258,  9348,   8421,   7470,   6489,
    5475,   4428,   3351,   2249,   1129,   0,      -1129,  -2249,  -3351,  -4428,  -5475,  -6489,  -7470,
    -8421,  -9348,  -10258, -11161, -12068, -12989, -13936, -14917, -15939, -17007, -18120, -19276, -20465,
    -21676, -22894, -24098, -25267, -26376, -27402, -28320, -29107, -29742, -30209, -30494, -30590,
};
std::array<int16_t, 129> triangleWaveAntiAliasing9 = {
    -31471, -31311, -30844, -30105, -29149, -28041, -26850, -25638, -24453, -23327, -22273, -21285, -20346,
    -19428, -18506, -17555, -16562, -15524, -14448, -13349, -12246, -11158, -10098, -9074,  -8084,  -7119,
    -6163,  -5201,  -4218,  -3205,  -2159,  -1087,  0,      1087,   2159,   3205,   4218,   5201,   6163,
    7119,   8084,   9074,   10098,  11158,  12246,  13349,  14448,  15524,  16562,  17555,  18506,  19428,
    20346,  21285,  22273,  23327,  24453,  25638,  26850,  28041,  29149,  30105,  30844,  31311,  31471,
    31311,  30844,  30105,  29149,  28041,  26850,  25638,  24453,  23327,  22273,  21285,  20346,  19428,
    18506,  17555,  16562,  15524,  14448,  13349,  12246,  11158,  10098,  9074,   8084,   7119,   6163,
    5201,   4218,   3205,   2159,   1087,   0,      -1087,  -2159,  -3205,  -4218,  -5201,  -6163,  -7119,
    -8084,  -9074,  -10098, -11158, -12246, -13349, -14448, -15524, -16562, -17555, -18506, -19428, -20346,
    -21285, -22273, -23327, -24453, -25638, -26850, -28041, -29149, -30105, -30844, -31311, -31471,
};
std::array<int16_t, 129> triangleWaveAntiAliasing15 = {
    -31982, -31726, -31009, -29965, -28768, -27570, -26465, -25471, -24543, -23616, -22636, -21588, -20495,
    -19403, -18349, -17346, -16376, -15406, -14405, -13363, -12293, -11223, -10179, -9172,  -8189,  -7207,
    -6200,  -5160,  -4097,  -3034,  -1994,  -986,   0,      986,    1994,   3034,   4097,   5160,   6200,
    7207,   8189,   9172,   10179,  11223,  12293,  13363,  14405,  15406,  16376,  17346,  18349,  19403,
    20495,  21588,  22636,  23616,  24543,  25471,  26465,  27570,  28768,  29965,  31009,  31726,  31982,
    31726,  31009,  29965,  28768,  27570,  26465,  25471,  24543,  23616,  22636,  21588,  20495,  19403,
    18349,  17346,  16376,  15406,  14405,  13363,  12293,  11223,  10179,  9172,   8189,   7207,   6200,
    5160,   4097,   3034,   1994,   986,    0,      -986,   -1994,  -3034,  -4097,  -5160,  -6200,  -7207,
    -8189,  -9172,  -10179, -11223, -12293, -13363, -14405, -15406, -16376, -17346, -18349, -19403, -20495,
    -21588, -22636, -23616, -24543, -25471, -26465, -27570, -28768, -29965, -31009, -31726, -31982,
};
std::array<int16_t, 129> triangleWaveAntiAliasing21 = {
    -32225, -31873, -30945, -29747, -28570, -27544, -26620, -25675, -24638, -23543, -22469, -21462, -20495,
    -19505, -18462, -17391, -16342, -15338, -14355, -13349, -12304, -11243, -10206, -9205,  -8214,  -7199,
    -6151,  -5096,  -4067,  -3069,  -2073,  -1051,  0,      1051,   2073,   3069,   4067,   5096,   6151,
    7199,   8214,   9205,   10206,  11243,  12304,  13349,  14355,  15338,  16342,  17391,  18462,  19505,
    20495,  21462,  22469,  23543,  24638,  25675,  26620,  27544,  28570,  29747,  30945,  31873,  32225,
    31873,  30945,  29747,  28570,  27544,  26620,  25675,  24638,  23543,  22469,  21462,  20495,  19505,
    18462,  17391,  16342,  15338,  14355,  13349,  12304,  11243,  10206,  9205,   8214,   7199,   6151,
    5096,   4067,   3069,   2073,   1051,   0,      -1051,  -2073,  -3069,  -4067,  -5096,  -6151,  -7199,
    -8214,  -9205,  -10206, -11243, -12304, -13349, -14355, -15338, -16342, -17391, -18462, -19505, -20495,
    -21462, -22469, -23543, -24638, -25675, -26620, -27544, -28570, -29747, -30945, -31873, -32225,
};
std::array<int16_t, 129> triangleWaveAntiAliasing31 = {
    -32442, -31930, -30766, -29602, -28656, -27710, -26632, -25554, -24571, -23589, -22531, -21473, -20478,
    -19483, -18433, -17384, -16383, -15381, -14337, -13292, -12287, -11283, -10240, -9198,  -8192,  -7185,
    -6144,  -5104,  -4096,  -3088,  -2048,  -1008,  0,      1008,   2048,   3088,   4096,   5104,   6144,
    7185,   8192,   9198,   10240,  11283,  12287,  13292,  14337,  15381,  16383,  17384,  18433,  19483,
    20478,  21473,  22531,  23589,  24571,  25554,  26632,  27710,  28656,  29602,  30766,  31930,  32442,
    31930,  30766,  29602,  28656,  27710,  26632,  25554,  24571,  23589,  22531,  21473,  20478,  19483,
    18433,  17384,  16383,  15381,  14337,  13292,  12287,  11283,  10240,  9198,   8192,   7185,   6144,
    5104,   4096,   3088,   2048,   1008,   0,      -1008,  -2048,  -3088,  -4096,  -5104,  -6144,  -7185,
    -8192,  -9198,  -10240, -11283, -12287, -13292, -14337, -15381, -16383, -17384, -18433, -19483, -20478,
    -21473, -22531, -23589, -24571, -25554, -26632, -27710, -28656, -29602, -30766, -31930, -32442,
};

std::span<int16_t> Triangle::getTriangleTable(uint32_t phase_increment) {
	if (phase_increment <= 102261126) {
		return triangleWaveAntiAliasing21;
	}
	if (phase_increment <= 143165576) {
		return triangleWaveAntiAliasing15;
	}
	if (phase_increment <= 238609294) {
		return triangleWaveAntiAliasing9;
	}
	if (phase_increment <= 429496729) {
		return triangleWaveAntiAliasing5;
	}
	if (phase_increment <= 715827882) {
		return triangleWaveAntiAliasing3;
	}
	return triangleWaveAntiAliasing1;
}
